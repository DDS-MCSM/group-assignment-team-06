---
title: "Data Driven Security - Project (Team 6)"
author: "Oriol Mominó Villegas - Alicia Ruiz Tovar"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
library(GroupAssignmentPackage)
GroupAssignmentPackage::loadDependencies()
```

# 1. Introducción

Hoy en día, en el mundo se producen cientos de miles de ciberataques cada segundo. La mayor parte de ellos no tienen ningún tipo de repercusión mediática ni social, pues son ataques pequeños que producen pocos daños y están diseñados para afectar a personas de forma individual (por ejemplo, phishing o spam); pero en esta última década cada vez más se producen ataques globales con consecuencias críticas para empresas, gobiernos, etc.

En la siguiente tabla podemos observar un ejemplo de tres de los ataques más sonados de los últimos tiempos.

Año de descubrimiento  | Nombre | Tipo | Descripción
------ | ---------- | ---------- | -------------------------------------
2017      | WannaCry    | Ransomware | Afectados >200.000 ordenadores en 150 paises
2016      | Mirai  | Botnet | Afectados multitud de dispositivos IoT, para DDoS a servidores DNS
2010      | Stuxnet    | Gusano | Reprogramación de sistemas SCADA

~~En 2017 se produjo el WannaCry, ransomware que afectó a más de 200.000 ordenadores en 150 paises~~

~~En 2016 se hizo uso de Mirai, botnet destinada a infectar dispositivos IoT, con el fin de realizar un DDoS a servidores DNS~~

~~En 2010 se descubrió el Stuxnet, gusano que era capaz de reprogramar sistemas SCADA~~

En los últimos años se ha sospechado que hay ciertas regiones del mundo que son origen de la mayoría de ataques que se producen en el resto del planeta. Quizás si se pudiera concretar los paises que más ataques generan, se podrían tomar medidas cautelares, entre otro tipo de acciones.


## 1.1. Pregunta a resolver

En base a esto, hemos pensado que sería interesante saber los ataques que produce cada país, para saber si hay alguno o algunos cuya cantidad de ataques sobresalga por encima de todos los demás y poder concluir si las sospechas de estos últimos años son ciertas.

Por ello, la pregunta que vamos a buscar resolver en este documento es la siguiente: **¿qué países son originarios de la mayor cantidad de ciberataques a nivel mundial?**

## 1.2. Dataset 

Para llevar a cabo el análisis, necesitábamos un dataset que recogiese información de ataques a nivel mundial bien diferenciados por países o regiones.

Finalmente, hemos encontrado este [dataset](http://datadrivensecurity.info/blog/pages/dds-dataset-collection.html) con información de 2013 sobre ataques que han captado un conjunto de AWS honeypots repartidas por el globo terrestre.


>   A un panal de rica miel
>
>   dos mil moscas acudieron
>
>   que por golosas murieron
>
>   presas de patas en él.
>
>>  Félix María Samaniego


# 2. Análisis

## 2.1. Obtención de la información

El primer paso a llevar a cabo para el análisis de la información es la descarga de los datos desde la [web](http://datadrivensecurity.info/blog/data/2014/01/marx-geo.tar.gz), junto a la posterior transformación a dataset para poder interactuar con ellos en R.

```{r download_dataset}
dataset <- GroupAssignmentPackage::downloadDataset()

```

Tras obtener los datos, podemos ver que el dataset tiene cantidad de información útil de los ataques: fecha y hora, honeypot a la que ha atacado, ip del atacante, país del atacante y coordenadas del país.

```{r str_dataset, echo=FALSE}
str(dataset)
```

## 2.2. Honeypots

Concretamente, el dataset contiene información de los ataques que reciben nueve honeypots repartidos por el mundo.


```{r list_honeypots, echo=FALSE}
levels(dataset$host)
```

No tenemos información exacta de dónde se encuentran las honeypots, pero por sus nombres podemos deducir que efectivamente, está repartidas por todo el globo terrestre.

El número de ataques recibidos por cada honeypot es el siguiente.

```{r honeypots_attacks, echo=FALSE}
honeypots_attacks <- GroupAssignmentPackage::host_attacks(dataset)
honeypots_attacks[order(-honeypots_attacks$attacks),]
```

Podemos obervar que las honeypots que más ataques reciben son las 

## 2.3. Países

```{r countries_setup, include = FALSE}
clean_dataset <- GroupAssignmentPackage::cleanDataset(dataset)
countries_dataset <- GroupAssignmentPackage::groupCountries(clean_dataset)
```
El dataset nos proporciona un listado bastante extenso sobre países del mundo en los que se originan ataques. A continuación podemos ver el listado completo:

Los países en los que se generan más ataques son: 

```{r top_countries_table, echo = FALSE}
countries_attacks <- countries_dataset[c("country","attacks")]
top10_countries_attacks <- head(countries_attacks[order(-countries_attacks$attacks),],10)
top10_countries_attacks
# TABLA Top 10 atacantes
# Quizás Top 10 sea mucho (se vea regular el gráfico) y haya que poner un TOP menor. O la inversa, si el TOP 11 y 12 atacan mucho, lo mismo hay que incluirlos
#35  CN 191394
#164 US  90005
#84  JP  17204
#78  IR  13042
#160 TW  12150
#122 NL  10739
#76  IN   9418
#88  KR   9316
#170 VN   7826
#140 RU   7211
# Insert code here

```

Podemos observar que hay un atacante que está claramente en primer lugar: China. En segundo lugar nos encontramos con Estados Unidos, que también está bastante alejado del tercer puesto, Japón. En sucesivos puestos nos encontramos con Irán, Taiwan, Países Bajos, India, Corea, Vietnam y Rusia.

A continuación, podemos observar un gráfico de barras con el Top 10 de atacantes:

```{r top_countries_chart, echo = FALSE}
top10_countries_attacks_plot <- top10_countries_attacks[order(top10_countries_attacks$attacks),]
barplot(top10_countries_attacks_plot$attacks, names = top10_countries_attacks_plot$country, horiz=TRUE,
  xlab = "Attacks", ylab = "Countries",
  main = "Top 10")
```

## 2.4. Gráficos con mapa mundial

Para mostrar el análisis de una forma más visual, hemos hecho uso de un mapa en blanco con todos los países del mundo perfectamente delimitados.

```{r empty_map, echo = FALSE}
world_map <- getMap()
plot(world_map)

```

## 2.4.1. Mapa de puntos

Gracias a que el dataset contiene información sobre las coordenadas de los atacantes, hemos podido representar el mapa de puntos que se muestra a continuación.

```{r coordinates_map, echo = FALSE}
coordinates_dataset <- GroupAssignmentPackage::groupCoordinates(clean_dataset)
GroupAssignmentPackage::coordinatesMap(coordinates_dataset)
```


## 2.4.2. Mapa de calor

Haciendo uso de los países de los atacantes, hemos podido generar este mapa de calor. El rojo más intenso representa los países que más ataques han generado, el amarillo menos intenso representan a los que menos. Los países en blanco representan que no se ha recibido ningún ataque desde esa región.

```{r countries_map, echo = FALSE, message=FALSE, warning=FALSE}
GroupAssignmentPackage::countriesMap(countries_dataset)

```


## 2.4.3. Mapa de calor (normalizado por población)
```{r countries_map_norm, echo = FALSE, message=FALSE, warning=FALSE}
GroupAssignmentPackage::countriesMapNorm(countries_dataset)

```

```{r countries_attacks_norm, echo = FALSE}
countries_attacks_norm <- countries_dataset[c("country","attacks_population")]
top10_countries_norm <- head(countries_attacks_norm[order(-countries_attacks_norm$attacks_population),],10)
top10_countries_norm
top10_countries_norm_plot <- top10_countries_norm[order(top10_countries_norm$attacks),]
barplot(top10_countries_norm_plot$attacks_population, names = top10_countries_norm_plot$country, horiz=TRUE,
  xlab = "Attacks", ylab = "Countries",
  main = "Top 10")
```



# 3. Conclusiones y preguntas futuras

- Afirmar o desmentir que hay países que claramente son atacantes

- Preguntas futuras: normalizar los datos para ver atacantes según población. Necesario otro dataset con


# 4. Anexo
Tabla con todos los paises acatantes ordenados alfabéticamente y su número de ataques
```{r countries_attacks, echo = FALSE}
countries_attacks[order(countries_attacks$country),]
```
