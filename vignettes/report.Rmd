---
title: "Data Driven Security - Project (Team 6)"
author: "Oriol Mominó Villegas - Alicia Ruiz Tovar"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
library(GroupAssignmentPackage)
GroupAssignmentPackage::loadDependencies()
```

# 1. Introducción

Hoy en día, en el mundo se producen cientos de miles de ciberataques cada segundo. La mayor parte de ellos no tienen ningún tipo de repercusión mediática ni social, pues son ataques pequeños que producen pocos daños y están diseñados para afectar a personas de forma individual (por ejemplo, phishing o spam); pero en esta última década cada vez más se producen ataques globales con consecuencias críticas para empresas, gobiernos, etc.

En la siguiente tabla podemos observar un ejemplo de tres de los ataques más sonados de los últimos tiempos.

Año de descubrimiento  | Nombre | Tipo | Descripción
------ | ---------- | ---------- | -------------------------------------
2017      | WannaCry    | Ransomware | Afectados >200.000 ordenadores en 150 países
2016      | Mirai  | Botnet | Afectados multitud de dispositivos IoT, para DDoS a servidores DNS
2010      | Stuxnet    | Gusano | Reprogramación de sistemas SCADA

En los últimos años se ha sospechado que hay ciertas regiones del mundo que son origen de la mayoría de ataques que se producen en el resto del planeta. Quizás si se pudiera concretar los paises que más ataques generan, se podrían tomar medidas cautelares, entre otro tipo de acciones.

## 1.1. Pregunta a resolver

En base a esto, hemos pensado que sería interesante saber los ataques que produce cada país, para saber si hay alguno o algunos cuya cantidad de ataques sobresalga por encima de todos los demás y poder concluir si las sospechas de estos últimos años son ciertas.

Por ello, la pregunta que en un principio íbamos a buscar resolver en este documento era la siguiente: *¿qué países son originarios de la mayor cantidad de ciberataques a nivel mundial?*

Sin embargo, pensando en esa incógnita nos ha surgido una pregunta aún más interesate: **¿qué países son originarios de la mayor cantidad de ciberataques a nivel mundial, teniendo en cuenta el tamaño de la población de cada país?** 

Presuponemos que hay ciertos países que seguro que aparecen en el top de países originarios de ataques, pero esta situación podría ser perfectamente normal ya que son países con mucha población, y por estadística debe haber más ataques que en otros países. Ahora bien, teniendo en cuenta el ratio "número de ataques" / "población del país", ¿seguirán esos países en el top?

## 1.2. Dataset 

Para llevar a cabo el análisis, necesitábamos un dataset que recogiese información de ataques a nivel mundial bien diferenciados por países o regiones.

Finalmente, hemos encontrado este [dataset](http://datadrivensecurity.info/blog/pages/dds-dataset-collection.html) con información de 2013 sobre ataques que han captado un conjunto de AWS honeypots repartidas por el globo terrestre.

## 1.3. Botnets y honeypots

Las botnet son una herramienta que utilizan los crackers (hackers malos) consistente en un conjunto de bots repartidos por todo el planeta. Estos bots pueden ser cualquier dispositivo conectado a internet y que haya sido infectado: desde un ordenador, una smartTV, un coche, hasta un frigorífico.

Una honeypot es una herramienta de ciberseguridad utilizada para simular un sistema real con el fin de engañar a la botnet, que ésta ataque a la simulación en vez de al sistema real, y así obtener información de la botnet y del atacante.

>   A un panal de rica miel
>
>   dos mil moscas acudieron
>
>   que por golosas murieron
>
>   presas de patas en él.
>
>>  Félix María Samaniego


# 2. Análisis

## 2.1. Obtención de la información

El primer paso a llevar a cabo para el análisis de la información es la descarga de los datos desde la [web](http://datadrivensecurity.info/blog/data/2014/01/marx-geo.tar.gz), junto a la posterior transformación a dataset para poder interactuar con ellos en R.

```{r download_dataset}
dataset <- GroupAssignmentPackage::downloadDataset()
```

Tras obtener los datos, podemos ver que el dataset tiene cantidad de información útil de los ataques: fecha y hora, honeypot a la que ha atacado, ip del atacante, país del atacante y coordenadas del país.

```{r str_dataset, echo=FALSE}
str(dataset)
```

Sin embargo, para mayor comodidad a la hora de trabajar con el dataset, hemos hecho una selección de la información con la que vamos a trabajar.

```{r clean_dataset, echo=FALSE}
clean_dataset <- GroupAssignmentPackage::cleanDataset(dataset)
str(clean_dataset)
```

## 2.2. Honeypots

Extrapolando la información del dataset, podemos concretar que la información que contiene el mismo es la relativa a ataques que han recibido varias honeypots repartidas por el mundo.

Las honeypots que nos encontramos son las siguientes:

```{r list_honeypots, echo=FALSE}
levels(clean_dataset$host)
```

Podemos ver que son un total de nueve honeypots. No tenemos información exacta de dónde se encuentran, pero por sus nombres podemos deducir que, efectivamente, están repartidas por todo el globo terrestre.

Empezando a analizar el dataset, la primera incógnita a la que quisimos darle solución es qué honeypot recibió más ataques, pues por proximidad geográfica se podría empezar a deducir qué región era la más agresiva del planeta. El número de ataques recibidos por cada honeypot es el que se indica a continuación.

```{r honeypots_attacks, echo=FALSE}
honeypots_attacks <- GroupAssignmentPackage::host_attacks(clean_dataset)
honeypots_attacks[order(-honeypots_attacks$attacks),]
```

Podemos obervar que las primera y tercera honeypots que más ataques reciben están en Asia, por lo que se empiezan a cumplir las sospechas iniciales de que los países con más población son los que más ataques generan.

## 2.3. Países

```{r countries_setup, include = FALSE}
countries_dataset <- GroupAssignmentPackage::groupCountries(clean_dataset)
```
El dataset nos proporciona un listado bastante extenso sobre países del mundo en los que se originan ataques. El listado completo del mismo se encuentra en el Anexo 1.

Los países en los que se generan más ataques son: 

```{r top_countries_table, echo = FALSE}
countries_attacks <- countries_dataset[c("country","attacks")]
top10_countries_attacks <- head(countries_attacks[order(-countries_attacks$attacks),],10)
top10_countries_attacks
```

Podemos observar que hay un atacante que está claramente en primer lugar: China. En segundo lugar nos encontramos con Estados Unidos, que también está bastante alejado del tercer puesto, Japón. En sucesivos puestos nos encontramos con Irán, Taiwán, Países Bajos, India, Corea, Vietnam y Rusia, que están bastante próximos entre sí.

A continuación, podemos ver la presentación de un gráfico de barras con los diez países que más ataques han realizado.

```{r top_countries_chart, echo = FALSE, fig.width = 8, fig.height = 12, fig.align = "center", out.width = "50%", out.height="20%"}
top10_countries_attacks_plot <- top10_countries_attacks[order(top10_countries_attacks$attacks),]
barplot(top10_countries_attacks_plot$attacks, names = top10_countries_attacks_plot$country, horiz=TRUE,
  xlab = "Ataques", ylab = "Países",
  main = "Top 10 de países: Ataques", cex.lab=1.5, cex.main=1.5)
```

## 2.4. Gráficos con mapa mundial

En los apartados sucesivos, vamos a mostrar de forma más visual datos sobre los países atacantes, gracias a este mapa en blanco con todos los países del mundo perfectamente delimitados.

```{r empty_map, echo = FALSE, fig.width = 8, fig.height = 8, fig.align = "center"}
world_map <- getMap()
plot(world_map, main="Mapa en blanco")

```

## 2.4.1. Mapa de puntos

En el mapa de puntos que se muestra a continuación, representamos cada IP diferente que se encuentra en el dataset como un punto en el mapa. Los puntos más grandes simbolizan que desde esa IP se han realizado multitud de ataques.

```{r coordinates_map, echo = FALSE, fig.width = 8, fig.height = 8, fig.align = "center"}
coordinates_dataset <- GroupAssignmentPackage::groupCoordinates(clean_dataset)
GroupAssignmentPackage::coordinatesMap(coordinates_dataset)
```

Observamos que es desde una región de Asia desde la que más ataques se producen, como bien mostraba el Top 10 de países atacantes.

## 2.4.2. Mapa de calor

Haciendo uso de la información relativa a los países, hemos podido generar este mapa de calor. El rojo más intenso representa los países que más ataques han generado, el amarillo menos intenso representa a los que menos. Los países en blanco representan que no se ha originado ningún ataque desde esa región, como por ejemplo Groenlandia, Namibia (África) o Papúa Nueva Guinea (Oceanía).

```{r countries_map, echo = FALSE, message=FALSE, warning=FALSE, fig.width = 8, fig.height = 8, fig.align = "center"}
GroupAssignmentPackage::countriesMap(countries_dataset)
```

Se muestra que, efectivamente, es desde China y desde Estados Unidos desde donde se realizan más ataques.

## 2.4.3. Mapa de calor normalizado por población

Una vez que tenemos la información relativa a los ataques de cada región y obteniendo la población de cada región (anexo 2), podemos establecer qué regiones son las que más atacan por habitante (anexo 3). 

Seguidamentre se muestra el Top 10 de estos países:

```{r countries_attacks_norm, echo = FALSE, fig.width = 8, fig.height = 14, fig.align = "center", out.width = "50%", out.height="30%"}
countries_attacks_norm <- countries_dataset[c("country","attacks_population")]
top10_countries_norm <- head(countries_attacks_norm[order(-countries_attacks_norm$attacks_population),],10)
top10_countries_norm
top10_countries_norm_plot <- top10_countries_norm[order(top10_countries_norm$attacks),]
barplot(top10_countries_norm_plot$attacks_population, names = top10_countries_norm_plot$country, horiz=TRUE,
  xlab = "Ataques/Población", ylab = "Países",
  main = "Top 10 de países: Ataques/población", cex.lab=1.5, cex.main=1.5)
```

Sorprendentemente, es Islandia el país que más ataques realiza por habitante: 1 ataque por cada 240 habitantes. 

Los únicos países que se encuentran tanto en el Top 10 normalizado como en el Top 10 sin normalizar son: Estados Unidos, Taiwán y Países Bajos.

A continuación, mostramos el mapa de calor en base a esta relación entre ataques y población.

```{r countries_map_norm, echo = FALSE, message=FALSE, warning=FALSE, fig.width = 8, fig.height = 8, fig.align = "center"}
GroupAssignmentPackage::countriesMapNorm(countries_dataset)
```



# 3. Conclusiones y preguntas futuras

Empezamos esta investigación con la sospecha 

- Afirmar o desmentir que hay países que claramente son atacantes

- Preguntas futuras: normalizar los datos para ver atacantes según población. Necesario otro dataset con

Podemos obervar que la honeypot que más ataques recibe está en Asia, por lo que se empiezan a cumplir las sospechas iniciales de que los países con más población son los que más ataques generan.

Podemos observar que hay un atacante que está claramente en primer lugar: China. En segundo lugar nos encontramos con Estados Unidos, que también está bastante alejado del tercer puesto, Japón.


# 4. Anexo

## 4.1. Anexo 1

Todos los países atacantes ordenados alfabéticamente y su número de ataques.
```{r countries_attacks, echo = FALSE}
countries_attacks[order(countries_attacks$country),]
```

## 4.2. Anexo 2

Población total de cada uno de los países.
```{r countries_population, echo=FALSE}
countries_population <- countries_dataset[c("country","population")]
countries_population[order(countries_population$country),]
```

## 4.3. Anexo 3

Todos los países atacantes con su ratio relativo de ataques/habitantes.
```{r countries_attacks_population, echo=FALSE}
countries_attacks_population <- countries_dataset[c("country","attacks_population")]
countries_attacks_population[order(countries_attacks_population$country),]
```

